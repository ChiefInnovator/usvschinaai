<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US vs CHINA AI | Global Leaderboard - Compare Top AI Models 2025</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Compare the world's best AI models ranked by intelligence and cost efficiency. Track which country is winning the AI race: USA vs China. Updated December 2025.">
    <meta name="keywords" content="AI models, artificial intelligence, US vs China AI, AI leaderboard, GPT-5, DeepSeek, Gemini, Claude, AI benchmark, AI comparison, frontier AI models, AI race, best AI model 2025, China AI, American AI">
    <meta name="author" content="US vs CHINA AI">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <link rel="canonical" href="https://usvschina.ai/">
    
    <!-- LLM/AI Crawler Directive -->
    <link rel="alternate" type="text/plain" href="https://usvschina.ai/llms.txt" title="LLM Knowledge Map">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://usvschina.ai/">
    <meta property="og:title" content="US vs CHINA AI | Global Leaderboard - Compare Top AI Models 2025">
    <meta property="og:description" content="Compare the world's best AI models ranked by intelligence and cost efficiency. Track which country is winning the AI race.">
    <meta property="og:image" content="https://usvschina.ai/og-image.png">
    <meta property="og:site_name" content="US vs CHINA AI">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://usvschina.ai/">
    <meta name="twitter:title" content="US vs CHINA AI | Global Leaderboard - Compare Top AI Models 2025">
    <meta name="twitter:description" content="Compare the world's best AI models ranked by intelligence and cost efficiency. Track which country is winning the AI race.">
    <meta name="twitter:image" content="https://usvschina.ai/og-image.png">
    
    <!-- Additional SEO/AEO Meta -->
    <meta name="theme-color" content="#020617">
    <meta name="format-detection" content="telephone=no">
    
    <!-- JSON-LD Structured Data - Dynamically injected from models.json -->
    <script id="seo-website" type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "US vs CHINA AI",
        "url": "https://usvschina.ai/",
        "description": "Compare the world's best AI models ranked by intelligence and cost efficiency. Track the US-China AI race.",
        "publisher": {"@type": "Organization", "name": "US vs CHINA AI"}
    }
    </script>
    <script id="seo-faq" type="application/ld+json"></script>
    <script id="seo-itemlist" type="application/ld+json"></script>
    <script id="seo-dataset" type="application/ld+json"></script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SpeakableSpecification",
        "cssSelector": ["#page-title", "#page-subtitle", ".glass h3"]
    }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #020617; color: #f8fafc; font-family: 'Inter', system-ui, sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); }
        .scoreboard-card { border: none; }
        .neon-blue { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .neon-red { box-shadow: 0 0 20px rgba(255, 0, 0, 0.5); }
        .winner-gradient { background: linear-gradient(90deg, #3b82f6, #ef4444); -webkit-background-clip: text; color: transparent; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .sort-icon { transition: transform 0.2s; }
        .sort-asc .sort-icon { transform: rotate(180deg); }

        /* 3D Flip Animation */
        .benchmark-details-table {
            font-size: 0.875rem;
            max-height: 600px;
            overflow-y: auto;
        }

        .benchmark-details-table th {
            position: sticky;
            top: 0;
            background: rgba(15, 23, 42, 0.95);
            z-index: 10;
        }

        .benchmark-details-table td {
            padding: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .benchmark-details-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .cost-badge {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #22c55e;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
    </style>
</head>
<body class="p-4 md:p-12 min-h-screen flex flex-col">
    <div class="max-w-6xl mx-auto w-full flex-grow">
        <!-- Navigation -->
        <nav class="flex flex-col md:flex-row justify-between items-center py-6 mb-12 border-b border-white/10 gap-4">
            <a href="index.html" class="text-2xl font-black italic tracking-tighter transition group flex items-center leading-none">
                <span class="group-hover:text-blue-400 transition">US</span>
                <span class="text-slate-600 mx-1 group-hover:text-slate-400 transition">vs</span>
                <span class="group-hover:text-red-400 transition">CHINA</span>
                <span class="winner-gradient px-2 inline-flex items-center leading-none">AI</span>
            </a>
            <div class="flex gap-8 text-sm font-bold uppercase tracking-widest">
                <a href="index.html" class="text-white border-b-2 border-blue-500 pb-1">Leaderboard</a>
                <a href="history.html" class="text-slate-500 hover:text-white transition">Archives</a>
                <a href="about.html" class="text-slate-500 hover:text-white transition">About</a>
            </div>
        </nav>

        <header class="text-center mb-12">
            <h1 class="text-6xl md:text-8xl font-black italic tracking-tighter mb-4" id="page-title">
                <!-- Title loaded from JSON -->
            </h1>
            <p class="text-slate-400 text-sm md:text-xl font-light tracking-widest uppercase px-4 break-words mb-6" id="page-subtitle"><!-- Subtitle loaded from JSON --></p>
            
            <!-- Share Buttons -->
            <div class="flex flex-wrap justify-center gap-2 md:gap-3">
                <button onclick="shareOnX()" class="flex items-center gap-2 bg-slate-800/80 hover:bg-slate-700 px-4 py-2 rounded-full transition text-slate-400 hover:text-white text-sm border border-white/10 hover:border-white/20">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    <span class="hidden sm:inline">X (formerly Twitter)</span>
                </button>
                <button onclick="shareOnFacebook()" class="flex items-center gap-2 bg-slate-800/80 hover:bg-[#1877F2] px-4 py-2 rounded-full transition text-slate-400 hover:text-white text-sm border border-white/10 hover:border-[#1877F2]">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                    <span class="hidden sm:inline">Facebook</span>
                </button>
                <button onclick="shareOnLinkedIn()" class="flex items-center gap-2 bg-slate-800/80 hover:bg-[#0A66C2] px-4 py-2 rounded-full transition text-slate-400 hover:text-white text-sm border border-white/10 hover:border-[#0A66C2]">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                    <span class="hidden sm:inline">LinkedIn</span>
                </button>
                <button onclick="copyLink()" class="flex items-center gap-2 bg-slate-800/80 hover:bg-purple-600 px-4 py-2 rounded-full transition text-slate-400 hover:text-white text-sm border border-white/10 hover:border-purple-500">
                    <i data-lucide="link" class="w-4 h-4"></i>
                    <span id="copy-link-text">Copy Link</span>
                </button>
                <button onclick="shareViaEmail()" class="flex items-center gap-2 bg-slate-800/80 hover:bg-green-600 px-4 py-2 rounded-full transition text-slate-400 hover:text-white text-sm border border-white/10 hover:border-green-500">
                    <i data-lucide="mail" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">Email</span>
                </button>
            </div>
        </header>

        <!-- National Scoreboard -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            <!-- Team USA -->
            <div class="glass scoreboard-card p-8 rounded-3xl border-2 border-blue-500/30 hover:border-blue-500/60 neon-blue relative group transition-all duration-300" id="team-usa-card">
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <h2 class="text-2xl font-bold text-blue-400 flex items-center gap-2" id="team-usa-name">
                            <!-- Name loaded from JSON -->
                        </h2>
                        <p class="text-slate-400 text-sm" id="team-usa-desc"><!-- Desc loaded from JSON --></p>
                    </div>
                    <span class="bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full text-xs font-bold" id="team-usa-badge"><!-- Badge loaded from JSON --></span>
                </div>
                
                <div class="flex justify-between items-end mt-6 relative z-10">
                    <span class="text-slate-400 text-sm uppercase tracking-wider">Total Score</span>
                    <div class="text-5xl md:text-6xl font-black text-blue-400" id="score-usa">0.0</div>
                </div>
                
                <div class="h-px bg-white/10 my-4 relative z-10"></div>

                <div class="space-y-2 relative z-10">
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-400">Avg IQ Index</span>
                        <span class="font-bold font-mono text-white" id="avg-iq-usa">0.0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-400">Avg Value Index</span>
                        <span class="font-bold font-mono text-white" id="avg-value-usa">0.0</span>
                    </div>
                </div>
            </div>

            <!-- Team China -->
            <div class="glass scoreboard-card p-8 rounded-3xl border-2 border-[#ff0000]/50 hover:border-[#ff0000]/80 neon-red relative group transition-all duration-300" id="team-china-card">
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <h2 class="text-2xl font-bold text-red-400 flex items-center gap-2" id="team-china-name">
                            <!-- Name loaded from JSON -->
                        </h2>
                        <p class="text-slate-400 text-sm" id="team-china-desc"><!-- Desc loaded from JSON --></p>
                    </div>
                    <span class="bg-yellow-500/20 text-yellow-500 px-3 py-1 rounded-full text-xs font-bold italic flex items-center gap-1" id="team-china-badge">
                        <!-- Badge loaded from JSON -->
                    </span>
                </div>

                <div class="flex justify-between items-end mt-6 relative z-10">
                    <span class="text-slate-400 text-sm uppercase tracking-wider">Total Score</span>
                    <div class="text-5xl md:text-6xl font-black text-red-400" id="score-china">0.0</div>
                </div>
                
                <div class="h-px bg-white/10 my-4 relative z-10"></div>

                <div class="space-y-2 relative z-10">
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-400">Avg IQ Index</span>
                        <span class="font-bold font-mono text-white" id="avg-iq-china">0.0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-400">Avg Value Index</span>
                        <span class="font-bold font-mono text-white" id="avg-value-china">0.0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Table -->
        <div class="glass rounded-3xl overflow-hidden shadow-2xl border border-white/5 mb-12" id="leaderboardFlipContainer">
                <!-- Toolbar -->
                <div class="p-6 border-b border-white/5 flex flex-col md:flex-row justify-between items-center gap-4">
                    <h3 class="text-xl font-bold flex items-center gap-2">
                        <i data-lucide="list-ordered" class="text-blue-400"></i> Leaderboard
                    </h3>
                    
                    <div class="flex items-center gap-2 bg-slate-900/50 p-1 rounded-lg border border-white/5">
                        <button onclick="setFilter('top10')" id="filter-top10" class="px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center gap-2 bg-blue-500 text-white shadow-lg shadow-blue-500/20">
                            <i data-lucide="trophy" class="w-3 h-3"></i> Top 10
                        </button>
                        <button onclick="setFilter('all')" id="filter-all" class="px-4 py-1.5 rounded-md text-sm font-bold text-slate-400 hover:text-white transition flex items-center gap-2 hover:bg-white/5">
                            <i data-lucide="globe" class="w-3 h-3"></i> All
                        </button>
                        <button onclick="setFilter('US')" id="filter-us" class="px-4 py-1.5 rounded-md text-sm font-bold text-slate-400 hover:text-white transition flex items-center gap-2 hover:bg-white/5">
                            <span>üá∫üá∏</span> USA
                        </button>
                        <button onclick="setFilter('CN')" id="filter-cn" class="px-4 py-1.5 rounded-md text-sm font-bold text-slate-400 hover:text-white transition flex items-center gap-2 hover:bg-white/5">
                            <span>üá®üá≥</span> China
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-900/80 text-slate-500 text-sm uppercase tracking-tighter" id="table-header">
                            <!-- Headers loaded from JSON -->
                        </thead>
                        <tbody class="divide-y divide-white/5" id="models-table-body">
                            <!-- Rows will be populated by JS -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Benchmarks Included -->
                <div class="p-6">
                    <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                        <i data-lucide="target" class="text-slate-400"></i> Benchmarks Included
                    </h3>
                    <div id="benchmarks-container" class="flex flex-wrap gap-2">
                        <!-- Loaded from JSON -->
                    </div>
                </div>
        </div>

        <!-- Intelligence vs Value Matrix -->
        <div class="glass rounded-3xl p-8 mb-12 border border-white/5">
            <h3 class="text-2xl font-bold mb-2 flex items-center gap-2">
                <i data-lucide="scatter-chart" class="text-purple-400"></i> Intelligence vs. Value Matrix
            </h3>
            <p class="text-slate-400 text-sm mb-6">Visualizing the trade-off between raw capability (IQ Index) and cost-efficiency (Value Index). The ideal model sits in the top-right quadrant.</p>
            
            <div class="relative w-full h-[500px]">
                <canvas id="matrixChart"></canvas>
            </div>
            
            <!-- Legend & Quadrant Guide -->
            <div class="flex flex-col md:flex-row justify-center items-center gap-6 mt-6">
                <div class="flex items-center gap-6">
                    <div class="flex items-center gap-2">
                        <span class="w-4 h-4 rounded-full bg-blue-500"></span>
                        <span class="text-slate-300 text-sm">USA Models</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-4 h-4 rounded-full bg-red-500"></span>
                        <span class="text-slate-300 text-sm">China Models</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-slate-500 text-sm">‚Ä¢</span>
                        <span class="text-slate-400 text-sm">Size = Unified Score</span>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                <div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-4 text-center">
                    <div class="flex items-center justify-center gap-2 text-blue-400 font-bold mb-1">
                        <span>üíé</span> High IQ, Low Value
                    </div>
                    <p class="text-slate-400 text-xs">Premium frontier models</p>
                </div>
                <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-4 text-center">
                    <div class="flex items-center justify-center gap-2 text-yellow-400 font-bold mb-1">
                        <span>üèÜ</span> High IQ, High Value
                    </div>
                    <p class="text-slate-400 text-xs">The sweet spot: Smart AND affordable</p>
                </div>
            </div>
        </div>

        <!-- Company Leaderboard -->
        <div class="glass rounded-3xl p-8 mb-12 border border-white/5">
            <h3 class="text-2xl font-bold mb-2 flex items-center gap-2">
                <i data-lucide="building-2" class="text-green-400"></i> Company Leaderboard
            </h3>
            <p class="text-slate-400 text-sm mb-6">Which companies are leading based on their models in the Global Top 10? Scores are summed from each company's models that made the cut.</p>
            
            <div id="company-leaderboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Methodology Section -->
        <div class="glass rounded-3xl p-8 mb-12 border border-white/5">
            <h3 class="text-2xl font-bold mb-6 flex items-center gap-2">
                <i data-lucide="book-open" class="text-slate-400"></i> Scoring Methodology
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-sm text-slate-400">
                <div>
                    <h4 class="text-white font-bold mb-2 text-lg">Unified Power Score (0‚Äì1000)</h4>
                    <p class="mb-2">Weighted blend emphasizing capability (90%) over cost efficiency (10%).</p>
                    <div class="bg-slate-900/50 p-4 rounded-xl font-mono text-xs mb-4">
                        Unified = 10 √ó (0.9 √ó norm(AvgIQ) + 0.1 √ó norm(Value))
                    </div>
                    <p class="mb-4 text-xs text-slate-500 italic">AvgIQ and Value are normalized within the cohort so every run is self-balancing.</p>
                    
                    <h4 class="text-white font-bold mb-2 text-lg">AvgIQ (capability)</h4>
                    <p class="mb-2">Participation-weighted average of benchmark scores. Each benchmark is min‚Äìmax normalized across the cohort, and benchmarks with only one participant are excluded from scoring.</p>
                    <p class="text-xs text-slate-500">This rewards models that perform well on widely reported tests while avoiding single-entry spikes.</p>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-2 text-lg">Value (efficiency)</h4>
                    <p class="mb-4">Value = AvgIQ √∑ (Input $/M + Output $/M). Lower cost with higher capability increases Value.</p>
                    <p class="text-xs text-slate-500 mb-4">Value is also normalized across the cohort before contributing to Unified.</p>
                    
                    <h4 class="text-white font-bold mb-2 text-lg">National Score</h4>
                    <p class="mb-4">For USA and China, we sum the Unified scores of that nation‚Äôs models inside the global Top 10.</p>
                    <p class="text-xs text-slate-500 italic">This rewards both peak performance and depth in the top of the table.</p>
                    <p class="text-xs text-slate-500 mt-4 border-t border-white/5 pt-4">
                        Not affiliated with any model provider. No guarantees are made about correctness, completeness, or fitness for any purpose.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="max-w-6xl mx-auto w-full text-center pb-8 text-slate-500 text-sm flex flex-col md:flex-row justify-between items-center gap-4 mt-12 border-t border-white/5 pt-8">
        <div>
            <p>&copy; 2025 US vs CHINA AI. All rights reserved.</p>
        </div>
        <div class="flex gap-4">
            <a href="index.html" class="hover:text-white transition">Leaderboard</a>
            <a href="history.html" class="hover:text-white transition">Archives</a>
            <a href="about.html" class="hover:text-white transition">About</a>
        </div>
    </footer>

    <script>
        const BASE_EXCLUDE_KEYS = new Set([
            'model', 'name', 'company', 'company_link', 'link', 'origin', 'description', 'created', 'total', 'avgIq', 'value', 'unified',
            'Model', 'Country', 'License', 'Context', 'Input$/M', 'Input $/M', 'Output$/M', 'Output $/M', 'Speed', 'Parameters(B)', 'KnowledgeCutoff', 'Multimodal', 'Released', 'Organization', '', 'rank'
        ]);
        const BENCHMARK_NAME_MAP = {
            'AIME2025': 'AIME 2025',
            'HMMT2025': 'HMMT 2025',
            'GPQA': 'GPQA Diamond',
            'GPQADiamond': 'GPQA Diamond',
            'BrowseComp': 'BrowseComp',
            'ARC-AGIv2': 'ARC-AGI v2',
            'HLE': 'HLE',
            'MMMLU': 'MMLU-Pro',
            'MMLU-Pro': 'MMLU-Pro',
            'LiveCodeBench': 'LiveCodeBench',
            'SWE-benchVerified': 'SWE-Bench Verified',
            'CodeForces': 'CodeForces',
            'CharXiv-R': 'CharXiv-R',
            'MMMU': 'MMMU',
            'MMMU-Pro': 'MMMU-Pro',
            'ScreenSpotPro': 'ScreenSpot Pro',
            'MCPAtlas': 'MCP Atlas',
            'SimpleQA': 'SimpleQA',
            'OSWorld': 'OSWorld',
            'Toolathlon': 'Toolathlon',
            'TerminalBench': 'Terminal Bench',
            'TAU2Retail': 'TAU2 Retail',
            'FrontierMath': 'FrontierMath'
        };

        let appData = {};
        let models = [];
        let benchmarkList = [];
        let currentEntry = null;
        let currentSort = { key: 'unified', direction: 'desc' };
        let currentFilter = 'top10';

        const formatNumber = (num, decimals = 1) => Number(num || 0).toFixed(decimals);
        const formatUnified = (num) => Number(num || 0).toFixed(2);
        const parseNumeric = (value) => {
            if (value === null || value === undefined) return null;
            const cleaned = String(value).replace(/[%$,]/g, '').trim();
            if (cleaned === '' || cleaned === '-' || cleaned.toLowerCase() === 'n/a') return null;
            const n = parseFloat(cleaned);
            return Number.isFinite(n) ? n : null;
        };

        const normalizeBenchmarkName = (key) => {
            if (BENCHMARK_NAME_MAP[key]) return BENCHMARK_NAME_MAP[key];
            return key.replace(/([a-z])([A-Z])/g, '$1 $2').replace(/(\d+)/g, ' $1').trim();
        };

        function extractBenchmarks(row) {
            const benchmarks = [];
            Object.entries(row || {}).forEach(([key, raw]) => {
                if (BASE_EXCLUDE_KEYS.has(key)) return;
                if (key.toLowerCase().includes('input') || key.toLowerCase().includes('output')) return;
                const score = parseNumeric(raw);
                const isKnownBenchmark = Boolean(BENCHMARK_NAME_MAP[key]);
                const hasPercent = typeof raw === 'string' && raw.includes('%');
                if (!isKnownBenchmark && !hasPercent) return;
                if (score === null) return;
                benchmarks.push({
                    key,
                    name: normalizeBenchmarkName(key),
                    score
                });
            });
            return benchmarks;
        }

        function normalizeModelsFromEntry(entry) {
            const combined = [...(entry?.teams?.US || []), ...(entry?.teams?.CN || [])];
            const normalized = combined.map((row) => {
                const benchmarks = extractBenchmarks(row);
                const benchmarkMap = {};
                benchmarks.forEach(b => { benchmarkMap[b.name] = b.score; });
                const costIn = parseNumeric(row['Input$/M'] ?? row['Input $/M']) ?? 0;
                const costOut = parseNumeric(row['Output$/M'] ?? row['Output $/M']) ?? 0;
                return {
                    name: row.model || row.name || 'Unknown Model',
                    origin: row.origin || 'US',
                    link: row.link || '#',
                    organization: row.organization || row.Organization || 'Unknown',
                    companyLink: row.link || '#',
                    createdDate: row.Released || row.created || '',
                    description: row.description || '',
                    iq: Number(row.avgIq) || 0,
                    value: Number(row.value) || 0,
                    unified: Number(row.unified) || 0,
                    benchmarks,
                    benchmarkMap,
                    costIn,
                    costOut
                };
            });

            normalized.sort((a, b) => b.unified - a.unified);
            normalized.forEach((m, idx) => { m.rank = idx + 1; });
            benchmarkList = Array.from(new Set(normalized.flatMap(m => m.benchmarks.map(b => b.name)))).sort();
            return normalized;
        }

        // Populate Benchmark Details Table (if present)
        function populateBenchmarkDetailsTable() {
            const tbody = document.getElementById('benchmark-details-tbody');
            if (!tbody || !models.length || !benchmarkList.length) return;

            const sorted = [...models].sort((a, b) => b.unified - a.unified);
            tbody.innerHTML = sorted.map(model => {
                const flag = model.origin === 'US' ? 'üá∫üá∏' : 'üá®üá≥';
                const originClass = model.origin === 'US' ? 'text-blue-400' : 'text-red-400';
                const benchmarkCells = benchmarkList.map(name => {
                    const score = model.benchmarkMap[name];
                    if (score === undefined || score === null) {
                        return '<td class="p-3 text-center text-slate-600">‚Äî</td>';
                    }
                    return `<td class="p-3 text-center text-green-400 font-semibold">${formatNumber(score)}</td>`;
                }).join('');

                const rankDisplay = model.rank === 1 ? 'ü•á' : (model.rank === 2 ? 'ü•à' : (model.rank === 3 ? 'ü•â' : `#${model.rank}`));
                return `
                    <tr class="hover:bg-white/5 transition">
                        <td class="p-3 font-bold">${rankDisplay}</td>
                        <td class="p-3">
                            <a href="${model.link}" target="_blank" class="font-semibold hover:text-blue-400 transition">
                                ${model.name}
                            </a>
                        </td>
                        <td class="p-3">
                            <span class="${originClass} font-semibold">${flag} ${model.origin}</span>
                        </td>
                        <td class="p-3 text-center font-semibold">${formatNumber(model.iq)}</td>
                        <td class="p-3 text-center font-semibold">${formatNumber(model.value)}</td>
                        <td class="p-3 text-center font-bold text-yellow-400">${formatUnified(model.unified)}</td>
                        ${benchmarkCells}
                    </tr>
                `;
            }).join('');
        }

        function getBenchmarkColor(name) {
            const blueGroup = ['AIME 2025', 'HMMT 2025', 'GPQA Diamond'];
            const redGroup = ['ARC-AGI', 'ARC-AGI v2', 'BrowseComp'];
            const purpleGroup = ['HLE', 'MMLU-Pro', 'LiveCodeBench', 'MMMU'];
            const yellowGroup = ['SWE-Bench Verified', 'CodeForces'];
            if (blueGroup.includes(name)) return 'bg-blue-500/10 border border-blue-500/20';
            if (redGroup.includes(name)) return 'bg-red-500/10 border border-red-500/20';
            if (purpleGroup.includes(name)) return 'bg-purple-500/10 border border-purple-500/20';
            if (yellowGroup.includes(name)) return 'bg-yellow-500/10 border border-yellow-500/20';
            return 'bg-slate-800 border border-white/5';
        }

        async function fetchModels() {
            try {
                const response = await fetch('models.json');
                appData = await response.json();
                const history = Array.isArray(appData.history) ? appData.history : [];
                if (!history.length) throw new Error('No history entries in models.json');
                currentEntry = history[0];
                models = normalizeModelsFromEntry(currentEntry);
                populateStaticContent();
                calculateTotals();
                renderTable();
                renderMatrix();
                renderCompanyLeaderboard();
                populateBenchmarkDetailsTable();
                updateFilterUI();
                if (window.lucide && typeof lucide.createIcons === 'function') {
                    lucide.createIcons();
                }
            } catch (error) {
                console.error('Error fetching models:', error);
            }
        }

        function populateStaticContent() {
            const metaTitle = appData?.metadata?.title || 'US vs CHINA AI';
            document.title = `${metaTitle} | Global Leaderboard`;

            const titleEl = document.getElementById('page-title');
            titleEl.innerHTML = `US <span class="text-slate-600 italic text-4xl md:text-6xl align-middle mx-2">vs</span> CHINA <span class="winner-gradient px-2 inline-flex items-center leading-none">AI</span>`;

            const subtitle = currentEntry?.timestamp ? `Updated ${currentEntry.timestamp}` : '';
            document.getElementById('page-subtitle').textContent = subtitle;

            if (appData?.teams?.usa && appData?.teams?.china) {
                const usa = appData.teams.usa;
                document.getElementById('team-usa-name').innerHTML = `${usa.name} ${usa.flag}`;
                document.getElementById('team-usa-desc').textContent = usa.description;
                document.getElementById('team-usa-badge').textContent = usa.badge;

                const china = appData.teams.china;
                document.getElementById('team-china-name').innerHTML = `${china.name} ${china.flag}`;
                document.getElementById('team-china-desc').textContent = china.description;
                document.getElementById('team-china-badge').textContent = china.badge;
            }

            const thead = document.getElementById('table-header');
            const cols = [
                { key: 'rank', label: 'Rank' },
                { key: 'name', label: 'Model' },
                { key: 'iq', label: 'AvgIQ (normalized)' },
                { key: 'value', label: 'Value (AvgIQ / Cost)' },
                { key: 'unified', label: 'Unified (0-1000)' }
            ];
            let headerRow = '<tr>';
            cols.forEach(col => {
                let alignClass = 'text-left';
                if (col.key === 'iq' || col.key === 'value') alignClass = 'text-center';
                if (col.key === 'unified') alignClass = 'text-right';
                headerRow += `
                    <th class="p-6 cursor-pointer hover:text-white transition group ${alignClass}" onclick="sortTable('${col.key}')">
                        <div class="flex items-center ${alignClass === 'text-right' ? 'justify-end' : (alignClass === 'text-center' ? 'justify-center' : '')} gap-1">
                            ${col.label} <i data-lucide="arrow-up-down" class="w-3 h-3 opacity-50 group-hover:opacity-100"></i>
                        </div>
                    </th>
                `;
            });
            headerRow += '</tr>';
            thead.innerHTML = headerRow;

            const benchmarksContainer = document.getElementById('benchmarks-container');
            if (benchmarksContainer) {
                benchmarksContainer.innerHTML = benchmarkList.map(b => {
                    const colorClass = getBenchmarkColor(b);
                    return `<span class="px-3 py-1.5 ${colorClass} rounded-lg text-xs text-slate-200">${b}</span>`;
                }).join('');
            }

            injectStructuredData();
        }

        function injectStructuredData() {
            if (!models.length || !currentEntry) return;
            const sorted = [...models].sort((a, b) => b.unified - a.unified);
            const top10 = sorted.slice(0, 10);
            const top1 = sorted[0];
            const usInTop10 = top10.filter(m => m.origin === 'US');
            const cnInTop10 = top10.filter(m => m.origin === 'CN');
            const usTotal = usInTop10.reduce((s, m) => s + m.unified, 0).toFixed(2);
            const cnTotal = cnInTop10.reduce((s, m) => s + m.unified, 0).toFixed(2);
            const leader = parseFloat(cnTotal) > parseFloat(usTotal) ? 'China' : 'USA';
            const loser = leader === 'China' ? 'USA' : 'China';
            const auditDate = currentEntry.timestamp || 'Latest run';
            const topUsModel = sorted.find(m => m.origin === 'US');
            const topUsRank = topUsModel ? sorted.indexOf(topUsModel) + 1 : 'N/A';

            const faqData = {
                "@context": "https://schema.org",
                "@type": "FAQPage",
                "mainEntity": [{
                    "@type": "Question",
                    "name": "What is the top AI model right now?",
                    "acceptedAnswer": {
                        "@type": "Answer",
                        "text": `${top1.name} leads with Unified ${formatUnified(top1.unified)} (AvgIQ ${formatNumber(top1.iq)}, Value ${formatNumber(top1.value)}). US leader ${topUsModel ? topUsModel.name : 'N/A'} sits at #${topUsRank}.`
                    }
                },{
                    "@type": "Question",
                    "name": "Is the US or China winning the AI race?",
                    "acceptedAnswer": {
                        "@type": "Answer",
                        "text": `As of ${auditDate}, ${leader} leads with ${leader === 'China' ? cnTotal : usTotal} vs ${loser}'s ${leader === 'China' ? usTotal : cnTotal} (Top 10 sum of Unified scores).`
                    }
                },{
                    "@type": "Question",
                    "name": "How are AI models ranked on this leaderboard?",
                    "acceptedAnswer": {
                        "@type": "Answer",
                        "text": "Models are ranked by Unified (0‚Äì1000) = 10 √ó (0.9 √ó normalized AvgIQ + 0.1 √ó normalized Value). AvgIQ is participation-weighted across benchmarks; Value = AvgIQ √∑ (Input + Output cost)."
                    }
                }]
            };
            document.getElementById('seo-faq').textContent = JSON.stringify(faqData);

            const itemListData = {
                "@context": "https://schema.org",
                "@type": "ItemList",
                "name": `Top 10 AI Models ${auditDate}`,
                "description": "Global ranking of frontier AI models by Unified score (capability √ó efficiency)",
                "numberOfItems": 10,
                "itemListElement": top10.map((m, i) => ({
                    "@type": "ListItem",
                    "position": i + 1,
                    "name": m.name,
                    "description": `Unified ${formatUnified(m.unified)} | Origin: ${m.origin === 'CN' ? 'China' : 'USA'}`
                }))
            };
            document.getElementById('seo-itemlist').textContent = JSON.stringify(itemListData);

            const datasetData = {
                "@context": "https://schema.org",
                "@type": "Dataset",
                "name": "US vs China AI Model Rankings",
                "description": "Ranking frontier AI models from the United States and China by Unified score (0‚Äì1000), combining normalized capability and cost efficiency.",
                "url": "https://usvschina.ai/",
                "license": "https://creativecommons.org/licenses/by/4.0/",
                "isAccessibleForFree": true,
                "creator": {"@type": "Organization", "name": "US vs CHINA AI"},
                "distribution": {
                    "@type": "DataDownload",
                    "encodingFormat": "application/json",
                    "contentUrl": "https://usvschina.ai/models.json"
                },
                "temporalCoverage": auditDate,
                "spatialCoverage": ["United States", "China"],
                "keywords": ["AI models", "frontier models", "benchmarks", "GPT", "DeepSeek", "Gemini", "Claude", "Qwen"]
            };
            document.getElementById('seo-dataset').textContent = JSON.stringify(datasetData);
        }

        function calculateTotals() {
            const allSorted = [...models].sort((a, b) => b.unified - a.unified);
            const top10 = allSorted.slice(0, 10);
            const usInTop10 = top10.filter(m => m.origin === 'US');
            const cnInTop10 = top10.filter(m => m.origin === 'CN');
            const usTotal = usInTop10.reduce((sum, m) => sum + m.unified, 0);
            const cnTotal = cnInTop10.reduce((sum, m) => sum + m.unified, 0);
            const usAvgIq = usInTop10.length ? usInTop10.reduce((sum, m) => sum + m.iq, 0) / usInTop10.length : 0;
            const usAvgVal = usInTop10.length ? usInTop10.reduce((sum, m) => sum + m.value, 0) / usInTop10.length : 0;
            const cnAvgIq = cnInTop10.length ? cnInTop10.reduce((sum, m) => sum + m.iq, 0) / cnInTop10.length : 0;
            const cnAvgVal = cnInTop10.length ? cnInTop10.reduce((sum, m) => sum + m.value, 0) / cnInTop10.length : 0;

            document.getElementById('score-usa').textContent = formatUnified(usTotal);
            document.getElementById('avg-iq-usa').textContent = formatNumber(usAvgIq);
            document.getElementById('avg-value-usa').textContent = formatNumber(usAvgVal);
            document.getElementById('score-china').textContent = formatUnified(cnTotal);
            document.getElementById('avg-iq-china').textContent = formatNumber(cnAvgIq);
            document.getElementById('avg-value-china').textContent = formatNumber(cnAvgVal);

            const usaCard = document.getElementById('team-usa-card');
            const chinaCard = document.getElementById('team-china-card');
            document.querySelectorAll('.leading-badge').forEach(el => el.remove());
            usaCard.classList.remove('ring-2', 'ring-blue-400', 'ring-offset-2', 'ring-offset-slate-900');
            chinaCard.classList.remove('ring-2', 'ring-red-400', 'ring-offset-2', 'ring-offset-slate-900');

            let leaderCard = null;
            let badgeColor = '';
            let ringColor = '';
            if (usTotal > cnTotal) { leaderCard = usaCard; badgeColor = 'bg-blue-500'; ringColor = 'ring-blue-400'; }
            else if (cnTotal > usTotal) { leaderCard = chinaCard; badgeColor = 'bg-red-500'; ringColor = 'ring-red-400'; }

            if (leaderCard) {
                const badge = document.createElement('div');
                badge.className = `leading-badge absolute -top-4 right-8 ${badgeColor} text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-lg flex items-center gap-2 z-20 transform transition-all duration-500 ease-out`;
                badge.innerHTML = `<i data-lucide="trophy" class="w-3 h-3"></i> Leading`;
                leaderCard.appendChild(badge);
                leaderCard.classList.add('ring-2', ringColor, 'ring-offset-2', 'ring-offset-slate-900');
                if (window.lucide && typeof lucide.createIcons === 'function') {
                    lucide.createIcons();
                }
            }
        }

        function renderTable() {
            const tbody = document.getElementById('models-table-body');
            tbody.innerHTML = '';

            let displayModels = [];
            if (currentFilter === 'top10') {
                displayModels = [...models].sort((a, b) => b.unified - a.unified).slice(0, 10);
            } else if (currentFilter === 'all') {
                displayModels = [...models];
            } else {
                displayModels = models.filter(m => m.origin === currentFilter);
            }

            displayModels.sort((a, b) => {
                const valA = a[currentSort.key];
                const valB = b[currentSort.key];
                if (currentSort.direction === 'asc') return valA > valB ? 1 : -1;
                return valA < valB ? 1 : -1;
            });

            const maxIq = Math.max(...models.map(m => m.iq), 1);
            const maxValue = Math.max(...models.map(m => m.value), 1);

            displayModels.forEach(model => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-white/5 transition group relative';

                let rankDisplay = `<span class="text-slate-400 font-mono">#${String(model.rank).padStart(2, '0')}</span>`;
                if (model.rank === 1) rankDisplay = `<span class="text-yellow-500 font-bold text-lg">01 ü•á</span>`;
                if (model.rank === 2) rankDisplay = `<span class="text-slate-300 font-bold text-lg">02 ü•à</span>`;
                if (model.rank === 3) rankDisplay = `<span class="text-orange-400 font-bold text-lg">03 ü•â</span>`;

                const flag = model.origin === 'US' ? 'üá∫üá∏' : 'üá®üá≥';
                const originClass = model.origin === 'US' ? 'text-blue-400' : 'text-red-400';
                const iqWidth = Math.min(100, (model.iq / maxIq) * 100);
                const valueWidth = Math.min(100, (model.value / maxValue) * 100);
                const description = model.description || '';

                tr.innerHTML = `
                    <td class="p-6">${rankDisplay}</td>
                    <td class="p-6">
                        <div class="flex flex-col">
                            <a href="${model.link}" target="_blank" class="font-bold text-lg hover:text-white hover:underline decoration-blue-500/50 underline-offset-4 transition flex items-center gap-2 peer">
                                ${model.name}
                                <span class="text-xs ${originClass} bg-white/5 px-2 py-0.5 rounded-full no-underline">${flag} ${model.origin}</span>
                                <i data-lucide="external-link" class="w-3 h-3 opacity-0 group-hover:opacity-50 transition"></i>
                            </a>
                            <div class="flex items-center gap-2 mt-1">
                                <a href="${model.companyLink}" target="_blank" class="text-xs text-slate-400 hover:text-blue-400 transition flex items-center gap-1">
                                    <i data-lucide="building-2" class="w-3 h-3"></i> ${model.organization}
                                </a>
                                <span class="text-xs text-slate-600">‚Ä¢</span>
                                <span class="text-xs text-slate-500">Released: ${model.createdDate || '‚Äî'}</span>
                            </div>
                            ${description ? `<p class="text-xs text-slate-500 mt-2 hidden group-hover:block max-w-sm leading-relaxed italic">${description}</p>` : ''}
                        </div>
                    </td>
                    <td class="p-6">
                        <div class="flex flex-col gap-1">
                            <div class="flex justify-between text-xs text-slate-400 mb-1">
                                <span>${formatNumber(model.iq)}</span>
                            </div>
                            <div class="w-full bg-slate-800 rounded-full h-1.5 overflow-hidden">
                                <div class="bg-blue-500 h-full rounded-full" style="width: ${iqWidth}%"></div>
                            </div>
                        </div>
                    </td>
                    <td class="p-6">
                        <div class="flex flex-col gap-1">
                            <div class="flex justify-between text-xs text-slate-400 mb-1">
                                <span>${formatNumber(model.value)}</span>
                            </div>
                            <div class="w-full bg-slate-800 rounded-full h-1.5 overflow-hidden">
                                <div class="bg-green-500 h-full rounded-full" style="width: ${valueWidth}%"></div>
                            </div>
                        </div>
                    </td>
                    <td class="p-6 text-right">
                        <span class="font-black text-2xl ${model.rank === 1 ? 'text-green-400' : 'text-white'}">${formatUnified(model.unified)}</span>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            if (window.lucide && typeof lucide.createIcons === 'function') {
                lucide.createIcons();
            }
        }

        function sortTable(key) {
            if (currentSort.key === key) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.key = key;
                currentSort.direction = 'desc';
            }
            renderTable();
        }

        function setFilter(filter) {
            currentFilter = filter;
            renderTable();
            renderMatrix();
            updateFilterUI();
        }

        function updateFilterUI() {
            const buttons = {
                'top10': document.getElementById('filter-top10'),
                'all': document.getElementById('filter-all'),
                'US': document.getElementById('filter-us'),
                'CN': document.getElementById('filter-cn')
            };
            Object.values(buttons).forEach(btn => {
                btn.className = 'px-4 py-1.5 rounded-md text-sm font-bold text-slate-400 hover:text-white transition flex items-center gap-2 hover:bg-white/5';
            });
            const activeBtn = buttons[currentFilter];
            if (currentFilter === 'top10') {
                activeBtn.className = 'px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center gap-2 bg-blue-500 text-white shadow-lg shadow-blue-500/20';
            } else if (currentFilter === 'all') {
                activeBtn.className = 'px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center gap-2 bg-purple-500/20 text-purple-400 border border-purple-500/50';
            } else if (currentFilter === 'US') {
                activeBtn.className = 'px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center gap-2 bg-blue-500/20 text-blue-400 border border-blue-500/50';
            } else if (currentFilter === 'CN') {
                activeBtn.className = 'px-4 py-1.5 rounded-md text-sm font-bold transition flex items-center gap-2 bg-red-500/20 text-red-400 border border-red-500/50';
            }
        }

        const shareUrl = 'https://usvschina.ai/';
        const shareTitle = 'US vs CHINA AI - Compare Top AI Models';
        const shareText = 'Check out this AI model leaderboard comparing USA and China\'s best AI models. See which country is winning the AI race!';

        function shareOnX() {
            const url = `https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareText)}`;
            window.open(url, '_blank', 'width=550,height=420');
        }

        function shareOnFacebook() {
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
            window.open(url, '_blank', 'width=550,height=420');
        }

        function shareOnLinkedIn() {
            const url = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(shareUrl)}`;
            window.open(url, '_blank', 'width=550,height=420');
        }

        function copyLink() {
            const btnText = document.getElementById('copy-link-text');
            const originalText = btnText.textContent;
            navigator.clipboard.writeText(shareUrl).then(() => {
                btnText.textContent = 'Copied!';
                setTimeout(() => { btnText.textContent = originalText; }, 2000);
            });
        }

        function shareViaEmail() {
            const subject = encodeURIComponent(shareTitle);
            const body = encodeURIComponent(`${shareText}\n\n${shareUrl}`);
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        let matrixChart = null;
        function renderMatrix() {
            const canvas = document.getElementById('matrixChart');
            if (!canvas || typeof canvas.getContext !== 'function') return;
            if (!window.Chart || !models.length) return;

            const ctx = canvas.getContext('2d');
            const allIq = models.map(m => m.iq);
            const allValue = models.map(m => m.value);
            const medianIq = [...allIq].sort((a, b) => a - b)[Math.floor(allIq.length / 2)];
            const medianValue = [...allValue].sort((a, b) => a - b)[Math.floor(allValue.length / 2)];
            const minUnified = Math.min(...models.map(m => m.unified));
            const maxUnified = Math.max(...models.map(m => m.unified));
            const denom = (maxUnified - minUnified) || 1;
            const scaleRadius = (unified) => 6 + ((unified - minUnified) / denom) * 14;

            const valueMin = Math.min(...allValue);
            const valueMax = Math.max(...allValue);
            const iqMin = Math.min(...allIq);
            const iqMax = Math.max(...allIq);
            const padX = Math.max(1, (valueMax - valueMin) * 0.1);
            const padY = Math.max(1, (iqMax - iqMin) * 0.1);

            const usData = models.filter(m => m.origin === 'US').map(m => ({ x: m.value, y: m.iq, name: m.name, unified: m.unified, r: scaleRadius(m.unified) }));
            const cnData = models.filter(m => m.origin === 'CN').map(m => ({ x: m.value, y: m.iq, name: m.name, unified: m.unified, r: scaleRadius(m.unified) }));

            if (matrixChart) matrixChart.destroy();

            matrixChart = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [
                        { label: 'Team USA', data: usData, backgroundColor: currentFilter === 'CN' ? 'rgba(59, 130, 246, 0.3)' : 'rgba(59, 130, 246, 0.8)', borderColor: '#3b82f6', borderWidth: 2, hoverBackgroundColor: '#3b82f6' },
                        { label: 'Team China', data: cnData, backgroundColor: currentFilter === 'US' ? 'rgba(239, 68, 68, 0.3)' : 'rgba(239, 68, 68, 0.8)', borderColor: '#ef4444', borderWidth: 2, hoverBackgroundColor: '#ef4444' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: { display: true, text: 'Value (AvgIQ √∑ Cost)', color: '#94a3b8', font: { size: 14, weight: 'bold' } },
                            grid: { color: 'rgba(255, 255, 255, 0.05)', drawBorder: false },
                            ticks: { color: '#64748b', font: { size: 11 } },
                            min: Math.max(0, valueMin - padX),
                            max: valueMax + padX
                        },
                        y: {
                            title: { display: true, text: 'AvgIQ (normalized)', color: '#94a3b8', font: { size: 14, weight: 'bold' } },
                            grid: { color: 'rgba(255, 255, 255, 0.05)', drawBorder: false },
                            ticks: { color: '#64748b', font: { size: 11 } },
                            min: Math.max(0, iqMin - padY),
                            max: iqMax + padY
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#f8fafc',
                            bodyColor: '#cbd5e1',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                title: (context) => {
                                    const flag = context[0].datasetIndex === 0 ? 'üá∫üá∏' : 'üá®üá≥';
                                    return `${flag} ${context[0].raw.name}`;
                                },
                                label: (context) => {
                                    const p = context.raw;
                                    return [
                                        `AvgIQ: ${formatNumber(p.y)}`,
                                        `Value: ${formatNumber(p.x)}`,
                                        `Unified: ${formatUnified(p.unified)}`
                                    ];
                                }
                            }
                        }
                    }
                },
                plugins: [{
                    id: 'quadrantLines',
                    beforeDraw: (chart) => {
                        const ctx = chart.ctx;
                        const xAxis = chart.scales.x;
                        const yAxis = chart.scales.y;
                        const xPos = xAxis.getPixelForValue(medianValue);
                        const yPos = yAxis.getPixelForValue(medianIq);
                        ctx.save();
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.15)';
                        ctx.lineWidth = 2;
                        ctx.setLineDash([6, 6]);
                        ctx.beginPath();
                        ctx.moveTo(xPos, yAxis.top);
                        ctx.lineTo(xPos, yAxis.bottom);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, yPos);
                        ctx.lineTo(xAxis.right, yPos);
                        ctx.stroke();
                        ctx.restore();
                    }
                }]
            });
        }

        function renderCompanyLeaderboard() {
            if (!models.length) return;
            const container = document.getElementById('company-leaderboard');
            if (!container) return;
            const top10 = models.slice().sort((a, b) => b.unified - a.unified).slice(0, 10);
            const orgScores = {};
            top10.forEach(m => {
                const org = m.organization || 'Unknown';
                if (!orgScores[org]) {
                    orgScores[org] = { name: org, totalScore: 0, modelCount: 0, models: [], origin: m.origin };
                }
                orgScores[org].totalScore += m.unified;
                orgScores[org].modelCount++;
                orgScores[org].models.push(m.name);
            });
            const sortedCompanies = Object.values(orgScores).sort((a, b) => b.totalScore - a.totalScore);
            container.innerHTML = sortedCompanies.map((c, idx) => {
                const flag = c.origin === 'US' ? 'üá∫üá∏' : 'üá®üá≥';
                const borderColor = c.origin === 'US' ? 'border-blue-500/30 hover:border-blue-500/60' : 'border-red-500/30 hover:border-red-500/60';
                const textColor = c.origin === 'US' ? 'text-blue-400' : 'text-red-400';
                const bgColor = c.origin === 'US' ? 'bg-blue-500/10' : 'bg-red-500/10';
                const rankIcon = idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : '';
                return `
                    <div class="glass p-6 rounded-2xl border ${borderColor} transition-all duration-300">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="text-lg font-bold ${textColor} flex items-center gap-2">
                                    ${rankIcon} ${c.name} ${flag}
                                </div>
                                <div class="text-xs text-slate-500">${c.modelCount} model${c.modelCount > 1 ? 's' : ''} in Top 10</div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-black text-white">${formatUnified(c.totalScore)}</div>
                                <div class="text-xs text-slate-500">Total Score</div>
                            </div>
                        </div>
                        <div class="${bgColor} rounded-lg p-3">
                            <div class="text-xs text-slate-400 mb-1">Models:</div>
                            <div class="text-sm text-slate-300">${c.models.join(', ')}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchModels();
        });
    </script>
</body>
</html>